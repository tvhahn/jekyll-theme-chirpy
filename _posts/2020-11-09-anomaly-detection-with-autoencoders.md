---
title: "Anomaly Detection - Advances in Condition Monitoring, Pt IV" 
date: "2020-11-10 8:05" 
categories: [Condition Monitoring, Anomaly Detection] 
tags: [ai, machine learning, condition monitoring, autoencoders, anomaly detection]      
description: "Machines fail. Anomaly detection, using an autoencoder, can be used to identify failures that have never been seen before."
image:
math: true
--- 

<div style="text-align: center; ">
<figure>
  <img src="/assets/img/wind_turbine.jpg" alt="wind turbine" style="background:none; border:none; box-shadow:none; text-align:center"/>
  <!-- <figcaption style="color:grey; font-size:smaller">Photo by <a href="https://www.pexels.com/@pixabay?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels">Pixabay</a> from <a href="https://www.pexels.com/photo/agriculture-alternative-energy-clouds-countryside-414837/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels">Pexels</a></figcaption> -->
</figure>
</div>
<br>


> Machines fail, and anomaly detection can be used to identify failures that have never been seen before. In this post, we explore the use of a simple autoencoder and see how it can be used for anomaly detection in industrial environments. 

Equipment fails. And if you’ve ever worked in an industrial environment, you’ll know that equipment can fail in any number of weird and wonderful ways. Detecting the strange behaviour in the machinery, early enough, is one way to help prevent these costly failures. Anomaly detection can be used to identify these warning signs before they become a serious issue. 

The classic definition of an anomaly was given by Douglas Hawkins: “an [anomaly] is an observation which deviates so much from other observations as to arouse suspicions that it was generated by a different mechanism.” [^hawkins1980identification] Sometimes, anomalies are clearly identified, and a data scientist can pick them out using straightforward methods. In reality, though, noise in the data makes anomaly detection difficult. Discriminating between the noise and the anomalies becomes the central challenge, as shown below in Figure 1. 


<div style="text-align: center; ">
<figure>
  <img src="/assets/img/anomaly_detection.png" alt="anomaly detection data continuum" style="background:none; border:none; box-shadow:none; text-align:center" width="400px"/>
  <div style="text-align: left; ">
  <br>
  <figcaption style="color:grey; font-size:smaller"> Figure 1: The continuum between normal data, noise, and anomalies. The challenge is differentiating between noise in the data and anomalies. (Figure made by author, modified from <a href="https://www.amazon.com/Outlier-Analysis-Charu-C-Aggarwal/dp/3319475770/ref=sr_1_1?crid=3FOZO1YOOGVD6&dchild=1&keywords=outlier+analysis&qid=1604970518&s=books&sprefix=outlier+analy%2Caps%2C196&sr=1-1">Charu C. Aggarwal in Outlier Analysis</a>)</figcaption>
  </div>
</figure>
</div>

There are many ways to perform anomaly detection. For an excellent overview, I recommend the book [Outlier Analysis](https://www.amazon.com/dp/3319475770/ref=cm_sw_r_tw_dp_x_KPGMFbXJ1ZFXA) by Aggarwal. But in the next few posts we’ll be looking at anomaly detection technique using an autoencoder, and specifically, a variational autoencoder. 

# The Autoencoder
An autoencoder is a neural network that learns to reconstruct its input. It was first introduced, back in the 80’s, by Hinton and Salakhutdinov.[^hinton2006reducing] Today, the autoencoder is widely used in machine learning applications.  

Below, in Figure 2,  is a picture of a simple autoencoder. This autoencoder has an input vector, $$\boldsymbol{x}$$, of five units. The output, $$\boldsymbol{x'}$$, has the same dimension as the input $$\boldsymbol{x}$$ -- also five units. The encoder takes the input and maps it to the hidden layer, $$\boldsymbol{z}$$, consisting of three latent variables, or hidden units. This is represented by: 

$$\boldsymbol{z} = \sigma(\boldsymbol{Wx}+\boldsymbol{b}) $$

<div style="text-align: center; ">
<figure>
  <img src="/assets/img/simle_autoencoder.png" alt="example of a simple autoencoder" style="background:none; border:none; box-shadow:none; text-align:center" width="300px"/>
  <div style="text-align: left; ">
  <figcaption style="color:grey; font-size:smaller"> Figure 2: A simple autoencoder having one input layer, one output layer, and a hidden layer. The hidden units are commonly called codings or latent variables. The hidden units are in the latent space. Image created by author.</figcaption>
  </div>
</figure>
</div>

Here, $$\sigma $$ is the activation function (such as a sigmoid or rectified linear unit). $$\boldsymbol{W} $$ is the weight matrix, and $$\boldsymbol{b} $$ is the bias vector. 

The decoder then takes the latent variables, $$\boldsymbol{z}$$ and maps them to the output space, represented by: 

$$\boldsymbol{x'} = \sigma'(\boldsymbol{W'z}+\boldsymbol{b'})$$

Like above, the $$\sigma'$$, $$\boldsymbol{W'}$$, and $$\boldsymbol{b'}$$ are the unique activation function, weight matrix, and biases for the decoder, respectively. 

The autoencoder is trained to minimize reconstruction error, often using mean-square-error, and is trained through back propagation.  

The power of the autoencoder lies in its ability to learn in a self-supervised way. Yann Lecun described the strength self-supervised learning in his Turing Award address: self-supervised learning allows models  to “learn about the world without training it for a particular task.” [^lecun_turing] This allows large swaths of data to be used in the training of the model – data that would not be available in supervised learning techniques. This power of self-supervised learning makes it attractive for use in manufacturing and industrial environments where much of the data is not properly labeled, and/or it would be too costly to label. Ultimately, self-supervised learning has led to dramatic advances in other fields, such as natural language processing and speech recognition. 

Finally, if you're all confused by the talk of "activation functions", "weights", and "biases", I recommend you watch the stellar explanation by 3Blue1Brown on YouTube. YouTube university is better than any college course...

<div style="text-align: center; ">
<iframe width="560" height="315" src="https://www.youtube.com/embed/aircAruvnKk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>

# Anomaly Detection with Autoencoders 

Autoencoders learn to reconstruct their inputs. However, the reconstruction will never be perfect. Feeding data into an autoencoder that is very different from what the autoencoder was trained on will produce a large reconstruction error. Feeding similar data will produce a lower reconstruction error. As such, this error in the reconstruction can be used as a proxy for how abnormal data is. A threshold can be set on this reconstruction error, whereby data producing a reconstruction error above the threshold is considered an anomaly. This is called input space anomaly detection. 

Most autoencoders, used for anomaly detection on industrial data, are first trained on healthy machinery data. Once trained, the autoencoder can be shown regular machinery data, containing both “healthy” and “unhealthy” data. Ideally, the autoencoder will have difficulty reconstructing the data from when the machinery is in an unhealthy state. Of course, there is much more nuance to this. Real-world industrial data is often noisy and messy. 

There are multiple examples of input space anomaly detection, using autoencoders, in condition monitoring. The method has been used to detect problems in aircraft hydraulic actuators.[^reddy2016anomaly] A [LSTM](https://en.wikipedia.org/wiki/Long_short-term_memory) (long short-term memory) autoencoder was used to detect anomalies in hydraulic pumps used in large industrial metal presses.[^lindemann2019anomaly] One group of researchers used a simple autoencoder on wind turbine control system data to identify 35% of all failures.[^lutz2020evaluation]  

# Conclusion 

Hopefully you have a sense of what an autoencoder is, and how it can be used for anomaly detection in industrial environments. In the next post we'll introduce a milling data set that we'll use to experiment with anomaly detection.

# References

[^hawkins1980identification]: Hawkins, Douglas M. [Identification of outliers](https://www.amazon.com/Identification-Outliers-Monographs-Statistics-Probability/dp/041221900X/ref=sr_1_1?dchild=1&keywords=Identification+of+Outliers+hawkins&qid=1605018126&sr=8-1). Vol. 11. London: Chapman and Hall, 1980. 

[^hinton2006reducing]: Hinton, Geoffrey E., and Ruslan R. Salakhutdinov. "[Reducing the dimensionality of data with neural networks](https://science.sciencemag.org/content/313/5786/504.full)." science 313.5786 (2006): 504-507. 

[^lecun_turing]: Geoffrey Hinton and Yann LeCun, 2018 ACM A.M. Turing Award Lecture “The Deep Learning Revolution” - YouTube. [https://youtu.be/VsnQf7exv5I](https://youtu.be/VsnQf7exv5I). Accessed 29 Oct. 2020. 

[^reddy2016anomaly]: Reddy, Kishore K., et al. "[Anomaly detection and fault disambiguation in large flight data: A multi-modal deep auto-encoder approach](http://www.phmsociety.org/sites/phmsociety.org/files/phm_submission/2016/phmc_16_026.pdf)." Annual Conference of the Prognostics and Health Management Society. Vol. 2016. 2016. 

[^lindemann2019anomaly]: Lindemann, Benjamin, et al. "[Anomaly detection in discrete manufacturing using self-learning approaches](https://doi.org/10.1016/j.procir.2019.02.073)." Procedia CIRP 79 (2019): 313-318. 

[^lutz2020evaluation]: Lutz, Marc-Alexander, et al. "[Evaluation of Anomaly Detection of an Autoencoder Based on Maintenace Information and Scada-Data](https://doi.org/10.3390/en13051063)." Energies 13.5 (2020): 1063. 
